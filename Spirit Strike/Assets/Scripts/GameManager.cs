using System.Collections;
using System.Collections.Generic;
using UnityEngine;

public class GameManager : Singleton<GameManager>
{
    int[] _spawnCounts = {1, 1, 1, 1};

    public int[] SpawnCounts
    {
        get
        {
            return _spawnCounts;
        }
    }

    int _slayCount;

    public int SlayCount
    {
        get
        {
            return _slayCount;
        }
    }

    int _stageCount = 1;

    public int StageCount
    {
        get
        {
            return _stageCount;
        }
    }

    SpawnEnemy[] _spawnPoints;

    bool _isBossMonster;

    public bool IsBossMonster
    {
        get
        {
            return _isBossMonster;
        }
    }

    public override void Awake()
    {
        base.Awake();       // Singleton 클래스는 유니티 씬에서 따로 부르는 부분이 없으므로 base.Awake()를 호출하여 부모 클래스를 실행하도록 유도
        _spawnPoints = FindObjectsOfType<SpawnEnemy>();
    }

    void Start()
    {
        foreach(var point in _spawnPoints)
        {
            point.CallSpawn();
        }
    }

    public void AddSlayCount()
    {
        // 보스몬스터가 아닌 몬스터 처치 시
        if(_isBossMonster == false)
        {
            _slayCount++;

            if (_slayCount >= _spawnCounts[_stageCount - 1] * _spawnPoints.Length)
            {
                if (_stageCount >= _spawnCounts.Length)
                {
                    return;
                }

                // ToDo : 스테이지 마지막에 보스 몬스터 소환하는 로직 추가하기
                _spawnPoints[0].SpawnBossMonster(_stageCount);
            }
        }
        else
        {
            GoToNextStage();
        }
    }

    void GoToNextStage()
    {
        _stageCount++;
        Debug.Log($"{_stageCount} 스테이지 입장");

        foreach (var point in _spawnPoints)
        {
            point.CallSpawn();
        }

        _slayCount = 0;
    }
}
